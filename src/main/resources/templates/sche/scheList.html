<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{index}">
  <div layout:fragment="content">

<script th:inline="javascript">
    /*<![CDATA[*/
	let schAllDatas = /*[[${scheList}]]*/
	 /*]]>*/
</script>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    var calendarEl = document.getElementById('calendar');
    let allEvents = schAllDatas;
    console.log('데이터', allEvents);
    
    let formattedEvents = allEvents.map(eventData => ({
      title: eventData.title,
      start: eventData.start,
      end: eventData.end,
      //color: eventData.postType == '1' ? 'indianred' : '#35A880',
      classNames: 'sideWork',
      extendedProps: {
    	  sche_uni_no: eventData.scheUniNo
      }
    }));
    
    
    var calendar = new FullCalendar.Calendar(calendarEl, {
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth'
      },
      eventClick: function(info) {
          console.log('이벤트: ' + info.event.title);
          let scheNo = info.event.extendedProps.scheUniNo;
          console.log(info.event.extendedProps);
   		  let scheData = info.event.extendedProps;
          fetch("scheInfo/"+scheData.sche_uni_no)
		.then((response) => response.json())
		.then((result) => {
			let scheInfo = result.scheInfo;
			console.log(result.partici);
			$('#ttl').text(scheInfo.title);
			$('#cntn').text(scheInfo.cntn);
			if(result.partici.length > 0){
			$('#partici').text(result.partici);
			}else{
				$('#partici').text('참여멤버가 없습니다')
			}
			document.getElementById('startDate').value =scheInfo.start;
			// $('#startDate').text(scheInfo.start);
			$('#finishDate').val(scheInfo.end); 
		 })
   		  
          if (info.event.url) {
              window.open(info.event.url);
            }
          $("#scheInfo").modal("show");
      },
      dateClick: function(info) {
    	  console.log(info)
    	  $("#scheInsert").modal("show");
      },     
      dayMaxEventRows: true, // for all non-TimeGrid views
      views: {
        timeGrid: {
          dayMaxEventRows: 6 // adjust to 6 only for timeGridWeek/timeGridDay
        }
      },
      initialDate: new Date(),
      navLinks: false, // can click day/week names to navigate views
      businessHours: false, // display business hours
      editable: true,
      selectable: false,
      allDaySlot:false,
      displayEventTime:true,
      locale:'ko',
      dayMaxEvents:true,
      events: formattedEvents
    });
    calendar.render();
  });
  

</script>


  <div id='calendar'></div>
  
  <!-- 일정 생성 모달 -->
                                              <div class="modal fade text-left" id="scheInsert" tabindex="-1"
                                                role="dialog" aria-labelledby="myModalLabel3752" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
                                                    role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" id="myModalLabel3752">일정 추가</h4>
                                                            <button type="button" class="close" data-bs-dismiss="modal"
                                                                aria-label="Close">
                                                                <i data-feather="x"></i>
                                                            </button>
                                                        </div>
                                                        <form action="#" id="scheInsert1">
                                                            <div class="modal-body">
                                                                <label>제목: </label>
                                                                <div class="form-group">
                                                                    <input type="text" placeholder="제목을 입력해주세요"
                                                                        class="form-control">
                                                                </div>
                                                                <label>내용: </label>
                                                                <div class="form-group">
                                                                    <input type="text" placeholder="내용을 입력해주세요"
                                                                        class="form-control">
                                                                </div>
                                                                <div class="form-group">
                                  								 	<div class="col-sm-10">
									                       			<label class="input-group-text">초대멤버</label>
																		<select class="choices form-select" multiple="multiple" id="cm">
																		<option th:value="${i.particiMembUniNo}" th:each="i:${membList}">[[${i.nnm}]]</option>
																	</select>
																	</div>
																</div>
                                                                <label> </label>
                                                                <div class="row">
                                                                <div class="col-sm-5">
                                                                <div class="form-group">
                                                                    <input type="datetime-local"
                                                                        class="form-control"></div>
                                                                        </div>
                                                                         &nbsp~&nbsp
                                                                <div class="col-sm-5">
                                                                <div class="form-group">
                                                                <input type="datetime-local" placeholder="Email Address"
                                                                        class="form-control"></div>
                                  									            </div>
                                  								</div>
                                  								 
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-light-secondary"
                                                                    data-bs-dismiss="modal">
                                                                    <i class="bx bx-x d-block d-sm-none"></i>
                                                                    <span class="d-none d-sm-block">취소</span>
                                                                </button>
                                                                <button type="button" onclick="insertSche()" class="btn btn-primary ml-1"
                                                                    data-bs-dismiss="modal">
                                                                    <i class="bx bx-check d-block d-sm-none"></i>
                                                                    <span class="d-none d-sm-block">저장하기</span>
                                                                </button>
                                                            </div>
                                                            </div>
                                                        
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>
            <!-- 일정 생성 모달 끝 -->
                                              <div class="modal fade text-left" id="scheInfo" tabindex="-1"
                                                role="dialog" aria-labelledby="myModalLabel37521" aria-hidden="true">
                                                <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
                                                    role="document">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" id="myModalLabel37521">일정 상세</h4>
                                                            <button type="button" class="close" data-bs-dismiss="modal"
                                                                aria-label="Close">
                                                                <i data-feather="x"></i>
                                                            </button>
                                                        </div>
                                                            <div class="modal-body">
                                                                <label>제목: </label>
                                                                <div class="form-group">
                                                                <p id="ttl"></p>
                                                                </div>
                                                                <label>참여멤버: </label>
                                                                <div class="form-group">
                                                                <p id="partici"></p>
                                                                </div>
                                                                <label>내용:</label>
                                                                <div class="form-group">
                                                                    <p id="cntn"></p>
                                                                </div>
                                                                <label> </label>
                                                                <div class="row">
                                                                <div class="col-sm-5">
                                                                <div class="form-group">
                                                                    <input type="datetime-local"
                                                                        class="form-control" id="startDate"></div>
                                                                        </div>
                                                                         &nbsp~&nbsp
                                                                <div class="col-sm-5">
                                                                <div class="form-group">
                                                                <input type="datetime-local" id="finishDate"
                                                                        class="form-control"></div>
                                  									            </div>
                                  								</div>
                                  								 
                                                            <div class="modal-footer">
                                                                <button type="button" class="btn btn-light-secondary"
                                                                    data-bs-dismiss="modal">
                                                                    <i class="bx bx-x d-block d-sm-none"></i>
                                                                    <span class="d-none d-sm-block">취소</span>
                                                                </button>
                                                                <button type="button" class="btn btn-primary ml-1"
                                                                    data-bs-dismiss="modal">
                                                                    <i class="bx bx-check d-block d-sm-none"></i>
                                                                    <span class="d-none d-sm-block">저장하기</span>
                                                                </button>
                                                            </div>
                                                            </div>
                                                    </div>
                                                </div>

            <!-- 일정 상세 보기 모달 -->
            
                     <script>
                     function insertSche(){
                   	  let scheData1 = $('#scheInsert1').serialize();
                   	  console.log(scheData1)
                   	  fetch("scheInsert",{
                             method : 'post',
                             body : scheData1
                          })
                          .then(result => result.json())
                          .then(data => {
                       	   console.log(data);
                          })
                     }
                     </script>                       
                                            
<!-- 레이아웃 끝 -->
</div>
</html>

	
	
	
	
	
	
	
	
<!-- <head>
	<meta charset="UTF-8">
	<title>scheList</title>
</head>
<body>
	
	<div id='calendar'></div>

<script src="../../static/fullcalendar-6.1.8/dist/index.global.js"></script> 
  <script src="/fullcalendar-6.1.8/dist/index.global.js"></script> 
 <script src="/static/fullcalendar-6.1.8/dist/index.global.js"></script> 

<script th:inline="javascript">
    /*<![CDATA[*/
	let schAllDatas = /*[[${scheList}]]*/
	 /*]]>*/
	</script>


<script>
// document.addEventListener('DOMContentLoaded', async function() {
  // await fetch('/readWorkSchView')
  
  var calendarEl = document.getElementById('calendar');
  let allEvents = schAllDatas;
  console.log('데이터', allEvents);
  
  let formattedEvents = allEvents.map(eventData => ({
    title: eventData.title,
    start: eventData.start,
    end: eventData.end,
    //color: eventData. == '1' ? 'indianred' : '#35A880',
    classNames: 'sideWork',
    extendedProps: { //저 위에 안들어가는것들은 여기안에 넣기
    		//타입맞춰서 넣기
        sche_uni_no: eventData.scheUniNo
    }
  }));



  var calendar = new FullCalendar.Calendar(calendarEl, {
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
    },
    eventClick: function(info) {
      console.log('이벤트: ' + info.event.title);
      //console.log('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY);
      //console.log('View: ' + info.view.type);
         let postNo = info.event.extendedProps.proPostNo;
      //console.log(postNo);
      // change the border color just for fun
      //info.el.style.borderColor = 'red';
      info.jsEvent.preventDefault();
      if (info.event.url) {
        window.open(info.event.url);
      }
     // console.log('event.target',event.target);
      //console.log('event.target',event.target.closest('.sideWork'));



    },
    dayMaxEventRows: true, // for all non-TimeGrid views
    views: {
      timeGrid: {
        dayMaxEventRows: 3 // adjust to 6 only for timeGridWeek/timeGridDay
      }
    },
    initialDate: new Date(), // 오늘날짜 넣기
    navLinks: true, // can click day/week names to navigate views.날짜를 선택하면 Day 캘린더나 Week 캘린더로 링크
    businessHours: false, // display business hours
    editable: false,//수정 가능?
    selectable: false,// 달력 일자 드래그 설정가능
    //dayMaxEvents: false, // 이벤트가 오버되면 높이 제한 (+ 몇 개식으로 표현)
    //locale: 'ko',
    events: formattedEvents
    
    
    
  });
  
  calendar.render();
  // });

  /* 데이터 양식 
  {
  groupId: 'availableForMeeting',
    title: 'Meeting',
    start: '2023-01-13T11:00:00',
    constraint: 'availableForMeeting', // defined below
    color: '#257e4a',
     end: '2023-01-20',
   display: 'background',
   overlap: false,
  } */
</script>
	</div>
</body>
</html> -->