<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{index}">

<head>
<meta charset="UTF-8">
<title>postList</title>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap"
	rel="stylesheet">
<link rel="stylesheet" href="assets/css/bootstrap.css">
<link rel="stylesheet"
	href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
<link rel="stylesheet"
	href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
<link rel="stylesheet" href="assets/css/app.css">
<link rel="shortcut icon" href="assets/images/favicon.svg"
	type="image/x-icon">
</head>

<body>
	<div layout:fragment="content">
		<div class="buttons">
			<a th:href="@{postInsert(brdUniNo=${postList[0].brdUniNo})}"
				class="btn btn-primary">글작성</a>
		</div>

		<hr>

		<div class="col-md-10 col-sm-12 mx-auto">
			<div th:if="${#lists.isEmpty(postList)}">
				게시글이없습니다

			</div>
		
			
			<div th:each="post : ${postList}" id="postPlace" class="card">
				<div class="card-content">
					<div class="card-body">
						<input id="postUniNo" type="hidden" th:value="${post.postUniNo}">
						<div class="row">
							<h4 class="card-title col">[[${post.ttl}]]</h4>
							<small class="text-muted col">[[${post.nnm}]]작성자</small>
						</div>
						<div class="row">
							<div class="dropdown">
								<button class="btn btn-primary dropdown-toggle me-1"
									type="button" id="dropdownMenuButton" data-bs-toggle="dropdown"
									aria-haspopup="true" aria-expanded="false">...</button>
								<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
									<a class="dropdown-item" href="#">즐겨찾기</a> <a
										class="dropdown-item" href="#">공지등록</a> <a
										th:if="${post.particiMembUniNo} == ${session.particiMembUniNo}"
										class="dropdown-item"
										th:href="@{postUpdate(postUniNo=${post.postUniNo})}">수정</a> <a
										th:if="${post.particiMembUniNo} == ${session.particiMembUniNo}"
										class="dropdown-item" data-bs-toggle="modal"
										data-bs-target="#primary">삭제</a>
								</div>

								<!--primary theme Modal -->
								<div class="modal fade text-left" id="primary" tabindex="-1"
									role="dialog" aria-labelledby="myModalLabel160"
									aria-hidden="true">
									<div
										class="modal-dialog modal-dialog-centered modal-dialog-scrollable"
										role="document">
										<div class="modal-content">
											<div class="modal-header bg-primary">
												<h5 class="modal-title white" id="myModalLabel160">게시글
													삭제</h5>
												<button type="button" class="close" data-bs-dismiss="modal"
													aria-label="Close">
													<i data-feather="x"></i>
												</button>
											</div>
											<div class="modal-body">
												이 페이지를 삭제하시겠습니까?<br> 삭제하시면 복구 할 수 없습니다.
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-light-secondary"
													data-bs-dismiss="modal">
													<i class="bx bx-x d-block d-sm-none"></i> <span
														class="d-none d-sm-block">취소</span>
												</button>
												<button id="deleteBtn" type="button"
													class="btn btn-primary ml-1" data-bs-dismiss="modal">
													<i class="bx bx-check d-block d-sm-none"></i> <span
														class="d-none d-sm-block">확인</span>
												</button>
											</div>
										</div>
									</div>
								</div>
								<hr>
								<p class="card-text">[[${post.cm}]]</p>
								<p class="card-text">[[${post.postTagArm}]]태그된사람들</p>
								<small class="text-muted">[[${#dates.format(post.writeDt,'yyyy-MM-dd')}]]</small>
							</div>
							첨부파일미리보기
						</div>

						<hr>
						<div id="replyPlace" class="card-body"></div>
						<div class="form-group position-relative has-icon-right">
							<input type="text" class="form-control" placeholder="reply">
							<div class="form-control-icon">
								<svg class="bi" width="1em" height="1em" fill="currentColor">
								<use
										xlink:href="assets/vendors/bootstrap-icons/bootstrap-icons.svg#reply" />
							</svg>
							</div>
						</div>
					</div>
				</div>
				<script>

			//댓글리스트
			function showReplyList(){
			let pNum = document.getElementById('postUniNo').value;
			
			fetch('http://localhost:80/modu/reply/'+pNum)
			.then(resolve => resolve.json())
			.then(data => {
				//console.log(data);
				data.forEach(reply => {
					let pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = reply.nnm + ' = 작성자, 작성자프로필이미지'
					document.getElementById('replyPlace').append(pTag);
					pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = '즐겨찾기추가, 수정, 삭제 이미지 넣기';
					document.getElementById('replyPlace').append(pTag);
					pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = reply.cntn;					
					document.getElementById('replyPlace').append(pTag);
					pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = reply.writeDt;
					document.getElementById('replyPlace').append(pTag);
				});
			}) 
			.catch(err => console.log(err))
		}
		showReplyList();
		
			
		document.getElementById('deleteBtn').addEventListener('click', function(event){
				let pNum = document.getElementById('postUniNo').value;
				console.log(pNum);
				fetch('http://localhost:80/modu/postDelete/'+pNum)
				.then(resolve => resolve.json())
				.then(data => {
					console.log(data);
				})
				.catch(err => console.log(err))
				
		})
		
	</script>
			</div>
		</div>
	</div>

</body>

<script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/main.js"></script>
</html>