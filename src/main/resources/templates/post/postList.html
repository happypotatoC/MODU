<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{index}">

<head>
<meta charset="UTF-8">
<title>postList</title>

<link rel="preconnect" href="https://fonts.gstatic.com">
<link
	href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap"
	rel="stylesheet">
<link rel="stylesheet" href="assets/css/bootstrap.css">
<link rel="stylesheet"
	href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
<link rel="stylesheet"
	href="assets/vendors/bootstrap-icons/bootstrap-icons.css">
<link rel="stylesheet" href="assets/css/app.css">
<link rel="shortcut icon" href="assets/images/favicon.svg"
	type="image/x-icon">
</head>

<body>
	<div layout:fragment="content">
		<div class="buttons">
			<a th:href="@{postInsert(brdUniNo=${postList[0].brdUniNo})}"
				class="btn btn-primary">글작성</a>
		</div>

		<hr>

		<div class="col-md-10 col-sm-12 mx-auto">
			<div th:each="post : ${postList}" id="postPlace" class="card">
				<div class="card-content">
					<div class="card-body">
						<input id="postUniNo" type="hidden" th:value="${post.postUniNo}">
						<div class="row">
							<h4 class="card-title col">[[${post.ttl}]]</h4>
							<small class="text-muted col">[[${post.nnm}]]작성자</small>
						</div>
						<div class="row">
							<div class="dropdown">
								<button class="btn btn-primary dropdown-toggle me-1" type="button"
										id="dropdownMenuButton" data-bs-toggle="dropdown"
										aria-haspopup="true" aria-expanded="false">
										...
								</button>
								<div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
										<a class="dropdown-item" href="#">즐겨찾기</a>
										<a class="dropdown-item" href="#">공지등록</a>
										<a th:if="${post.particiMembUniNo} == ${session.particiMembUniNo}" class="dropdown-item" th:href="@{postUpdate(postUniNo=${post.postUniNo})}">수정</a>
										<a th:if="${post.particiMembUniNo} == ${session.particiMembUniNo}" class="dropdown-item" href="#">삭제</a>
								</div>
						<hr>
						<p class="card-text">[[${post.cm}]]</p>
						<p class="card-text">[[${post.postTagArm}]]태그된사람들</p>
						<small class="text-muted">[[${#dates.format(post.writeDt,'yyyy-MM-dd')}]]</small>
					</div>
					첨부파일미리보기
				</div>

				<hr>
				<div id="replyPlace" class="card-body">
				</div>
				<div class="form-group position-relative has-icon-right">
					<input type="text" class="form-control" placeholder="reply">
					<div class="form-control-icon">
						<svg class="bi" width="1em" height="1em" fill="currentColor">
								<use
								xlink:href="assets/vendors/bootstrap-icons/bootstrap-icons.svg#reply" />
							</svg>
					</div>
				</div>
			</div>
		</div>
		<script>

			//댓글리스트
			function showReplyList(){
			let pNum = 'pt1'
			console.log(pNum);
			fetch('http://localhost:80/modu/reply/'+pNum)
			.then(resolve => resolve.json())
			.then(data => {
				console.log(data[0].cntn);
				data.forEach(reply => {
					let pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = reply.nnm + ' = 작성자, 작성자프로필이미지'
					document.getElementById('replyPlace').append(pTag);
					pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = '즐겨찾기추가, 수정, 삭제 이미지 넣기';
					document.getElementById('replyPlace').append(pTag);
					pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = reply.cntn;					
					document.getElementById('replyPlace').append(pTag);
					pTag=document.createElement('p');
					pTag.setAttribute('class','card-text');
					pTag.textContent = reply.writeDt;
					document.getElementById('replyPlace').append(pTag);
				});
			}) 
			.catch(err => console.log(err))
		}
		showReplyList();
	</script>
	</div>
</body>

<script src="assets/vendors/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script src="assets/js/bootstrap.bundle.min.js"></script>
<script src="assets/js/main.js"></script>
</html>